<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Mouse的博客</title>
		<description>记录学习生活工作的点滴</description>
		<link>http://localhost:4000</link>
		<atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
		
			<item>
				<title>idea</title>
				<description>&lt;h1 id=&quot;idea-in-windows&quot;&gt;Idea in windows&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;去官网下载  &lt;a href=&quot;https://www.jetbrains.com/zh-cn/idea/&quot;&gt;https://www.jetbrains.com/zh-cn/idea/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;插件安装 ：&lt;code class=&quot;highlighter-rouge&quot;&gt;File&lt;/code&gt; -&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;Settings&lt;/code&gt; -&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;Plugins&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;去 file -&amp;gt; settings 搜索maven 看看 maven的settings.xml 在哪里，备份下，然后把阿里云的源添加进去     &lt;a href=&quot;/images/202205/settings-personal.xml&quot;&gt;settings-personal.xml&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;修改idea内存&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/202205/idea_vm_options.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;下面这段我不知道从哪儿抄来的，其中最有用的就是 设置内存     -Xmx4096m&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# custom IntelliJ IDEA VM options
    
-Xms128m
-Xmx4096m
-XX:ReservedCodeCacheSize=240m
-XX:+UseCompressedOops
-Dfile.encoding=UTF-8
-XX:+UseConcMarkSweepGC
-XX:SoftRefLRUPolicyMSPerMB=50
-ea
-XX:CICompilerCount=2
-Dsun.io.useCanonCaches=false
-Djava.net.preferIPv4Stack=true
-Djdk.http.auth.tunneling.disabledSchemes=&quot;&quot;
-XX:+HeapDumpOnOutOfMemoryError
-XX:-OmitStackTraceInFastThrow
    
-XX:ErrorFile=$USER_HOME/java_error_in_idea_%p.log
-XX:HeapDumpPath=$USER_HOME/java_error_in_idea.hprof
    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;显示idea使用内存情况  右下角右键 选中 memory indicator (内存指示器)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;更改主题 ：   &lt;a href=&quot;/images/202205/dark_theme.icls&quot;&gt;dark_theme.icls&lt;/a&gt;  个人比较喜欢这款糖果配色
file-&amp;gt; settings -&amp;gt; 搜索color scheme -&amp;gt; import 上述文件即可&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;问题1： 为什么我的IDEA是中文？&lt;/p&gt;

&lt;p&gt;解决1： 去plugins中把chinese那个插件停用了&lt;/p&gt;
</description>
				<pubDate>Fri, 27 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/Idea-in-windows</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/Idea-in-windows</guid>
			</item>
		
			<item>
				<title>vs code</title>
				<description>&lt;h1 id=&quot;vs-code-in-windows&quot;&gt;VS code in windows&lt;/h1&gt;

&lt;p&gt;参考文章： &lt;a href=&quot;https://blog.csdn.net/weixin_44211968/article/details/122605298&quot;&gt;https://blog.csdn.net/weixin_44211968/article/details/122605298&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;官网下载: &lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;https://code.visualstudio.com/&lt;/a&gt;&lt;/p&gt;

</description>
				<pubDate>Thu, 26 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/VS-code-in-windows</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/VS-code-in-windows</guid>
			</item>
		
			<item>
				<title>jdk</title>
				<description>&lt;h1 id=&quot;jdk-in-windows&quot;&gt;jdk in windows&lt;/h1&gt;

&lt;p&gt;参考文章：&lt;a href=&quot;https://blog.csdn.net/qq_45752401/article/details/121220471&quot;&gt;https://blog.csdn.net/qq_45752401/article/details/121220471&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;一般都是64位系统， 我们去官网下载并安装 &lt;a href=&quot;https://www.oracle.com/java/technologies/downloads/#java11&quot;&gt;https://www.oracle.com/java/technologies/downloads/#java11&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;打开powershell 敲 java -version 如果能正常展示 就ok了， 如果没有，则可能需要配置下面的环境变量。&lt;/li&gt;
  &lt;li&gt;配置系统环境变量 右击“我的电脑”–&amp;gt;“高级”–&amp;gt;“环境变量”
    &lt;ol&gt;
      &lt;li&gt;JAVA_HOME环境变量。 
 &lt;img src=&quot;/images/202205/java_home.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/li&gt;
      &lt;li&gt;path环境变量
 &lt;img src=&quot;/images/202205/path.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;
</description>
				<pubDate>Wed, 25 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/windows-install-jdk</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/windows-install-jdk</guid>
			</item>
		
			<item>
				<title>transactional</title>
				<description>&lt;h1 id=&quot;transactional注解&quot;&gt;Transactional注解&lt;/h1&gt;

&lt;p&gt;代码仓库: &lt;a href=&quot;https://github.com/gongchangyou/transactional&quot;&gt;https://github.com/gongchangyou/transactional&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;其实 Mybatis plus中的 ServiceImpl 的save操作都已经是事务级别的了, 我们来试试，如果取消了这个transactional注解会发生什么.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG226.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;比如现在有10个线程，同时更新id=1 的row .value ++ ，结果肯定不是10&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    private ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10,10,0, TimeUnit.SECONDS, new LinkedBlockingQueue&amp;lt;&amp;gt;(10));

 @Test
    void unThreadSafe() {
        for (int i = 0; i &amp;lt; 10;i++) {
            threadPoolExecutor.submit(() -&amp;gt; {
                val model = testMapper.selectById(1L);
            log.info(&quot;start value={}&quot;, model.getValue());
            val ret = testMapper.updateById(com.mouse.transactional.repository.db.model.Test
                        .builder()
                        .id(1L)
                        .value(model.getValue() + 1)
                        .build()
                );
                log.info(&quot;ret={}&quot;, ret);
            });
        }

        try {
            Thread.sleep(2000L);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如何保证呢？&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;我们做个事务方法, 这里使用select for update加行锁, 并添加 @Transactional注解&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; @Slf4j
 @Service
 public class TestService extends ServiceImpl&amp;lt;TestMapper, Test&amp;gt; implements IService&amp;lt;Test&amp;gt; {

     @Transactional
     public void incr(long id) {
         val model = baseMapper.selectOne(new LambdaQueryWrapper&amp;lt;Test&amp;gt;()
                 .eq(com.mouse.transactional.repository.db.model.Test::getId, 1L)
                 .last(&quot; for update&quot;));
         log.info(&quot;value={}&quot;, model.getValue());
         model.setValue(model.getValue() + 1);
         updateById(model);
     }

 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;测试一下, 这回成了，test表的value正好加了10.&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;      private ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10,10,0, TimeUnit.SECONDS, new LinkedBlockingQueue&amp;lt;&amp;gt;(10));

     @Test
     void TransactionalUpdate() {
         for (int i = 0; i &amp;lt; 10;i++) {
             threadPoolExecutor.submit(() -&amp;gt; {
                 testService.incr(1L);
             });
         }

         try {
             Thread.sleep(2000L);
         } catch (InterruptedException e) {
             e.printStackTrace();
         }
     }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;当然如果抛异常的话，那么里面的操作就不执行. 如下手动抛出异常，里面的更新操作就不会执行。
&lt;img src=&quot;/images/202205/WechatIMG227.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;源码解析:&lt;/p&gt;

&lt;p&gt;核心逻辑在 spring-tx包中的 类 TransactionAspectSupport 中：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG230.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

</description>
				<pubDate>Mon, 23 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/transactional</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/transactional</guid>
			</item>
		
			<item>
				<title>pojo</title>
				<description>&lt;h1 id=&quot;pojo-groovy&quot;&gt;Pojo groovy&lt;/h1&gt;

&lt;p&gt;代码仓库:  &lt;a href=&quot;https://github.com/gongchangyou/tool&quot;&gt;https://github.com/gongchangyou/tool&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;自动生成pojo&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import com.intellij.database.model.DasTable
import com.intellij.database.util.Case
import com.intellij.database.util.DasUtil

/*
 * Available context bindings:
 *   SELECTION   Iterable&amp;lt;DasObject&amp;gt;
 *   PROJECT     project
 *   FILES       files helper
 */

typeMapping = [
  (~/(?i)int/)                      : &quot;Long&quot;,
  (~/(?i)float|double|decimal|real/): &quot;Double&quot;,
  (~/(?i)datetime|timestamp/)       : &quot;java.sql.Timestamp&quot;,
  (~/(?i)date/)                     : &quot;java.sql.Date&quot;,
  (~/(?i)time/)                     : &quot;java.sql.Time&quot;,
  (~/(?i)/)                         : &quot;String&quot;
]

FILES.chooseDirectoryAndSave(&quot;Choose directory&quot;, &quot;Choose where to store generated files&quot;) { dir -&amp;gt;
  SELECTION.filter { it instanceof DasTable }.each { generate(it, dir) }
}

def generate(table, dir) {
  def className = javaName(table.getName(), true)
  def fields = calcFields(table)
  def packageName = getPackageName(dir)
  new File(dir, className + &quot;.java&quot;).withPrintWriter { out -&amp;gt; generate(out, className, fields, packageName, table) }
}

def generate(out, className, fields, packageName, table) {
  out.println &quot;package $packageName&quot;
  out.println &quot;&quot;
  out.println &quot;&quot;
  out.println &quot;import com.baomidou.mybatisplus.annotation.IdType;\n&quot; +
          &quot;import com.baomidou.mybatisplus.annotation.TableId;\n&quot; +
          &quot;import com.baomidou.mybatisplus.annotation.TableName;\n&quot; +
          &quot;import lombok.AllArgsConstructor;\n&quot; +
          &quot;import lombok.Builder;\n&quot; +
          &quot;import lombok.Data;\n&quot; +
          &quot;import lombok.NoArgsConstructor;&quot;
    out.println &quot;&quot;
    out.println &quot;@Builder\n&quot; +
            &quot;@AllArgsConstructor\n&quot; +
            &quot;@NoArgsConstructor\n&quot; +
            &quot;@Data\n&quot; +
            &quot;@TableName(\&quot;${table.getName()}\&quot;)&quot;
    out.println &quot;public class $className {&quot;
  out.println &quot;&quot;
  fields.each() {
    if (it.comment != &quot;&quot;) {
        out.println &quot;  /**&quot;
        out.println &quot;   * ${it.comment}&quot;
        out.println &quot;   */&quot;
    }
      if (it.isPrimaryKey) {
          out.println &quot;  @TableId(type = IdType.AUTO)&quot;
      }
    out.println &quot;  private ${it.type} ${it.name};&quot;
  }
  out.println &quot;&quot;
//  fields.each() {
//    out.println &quot;&quot;
//    out.println &quot;  public ${it.type} get${it.name.capitalize()}() {&quot;
//    out.println &quot;    return ${it.name};&quot;
//    out.println &quot;  }&quot;
//    out.println &quot;&quot;
//    out.println &quot;  public void set${it.name.capitalize()}(${it.type} ${it.name}) {&quot;
//    out.println &quot;    this.${it.name} = ${it.name};&quot;
//    out.println &quot;  }&quot;
//    out.println &quot;&quot;
//  }
  out.println &quot;}&quot;
}

def calcFields(table) {
    DasUtil.getColumns(table).reduce([]) { fields, col -&amp;gt;
    def spec = Case.LOWER.apply(col.getDataType().getSpecification())
    def typeStr = typeMapping.find { p, t -&amp;gt; p.matcher(spec).find() }.value
    fields += [[
                 name : javaName(col.getName(), false),
                 type : typeStr,
                 comment : col.getComment(),
                 isPrimaryKey :  DasUtil.isPrimary(col),
                 annos: &quot;&quot;]]
  }
}

def javaName(str, capitalize) {
  def s = com.intellij.psi.codeStyle.NameUtil.splitNameIntoWords(str)
    .collect { Case.LOWER.apply(it).capitalize() }
    .join(&quot;&quot;)
    .replaceAll(/[^\p{javaJavaIdentifierPart}[_]]/, &quot;_&quot;)
  capitalize || s.length() == 1? s : Case.LOWER.apply(s[0]) + s[1..-1]
}

def getPackageName(dir) {
    return dir.toString().replaceAll(&quot;\\\\&quot;, &quot;.&quot;).replaceAll(&quot;/&quot;, &quot;.&quot;).replaceAll(&quot;^.*src(\\.main\\.java\\.)?&quot;, &quot;&quot;) + &quot;;&quot;
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
				<pubDate>Sat, 21 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/pojo-groovy</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/pojo-groovy</guid>
			</item>
		
			<item>
				<title>es 中文分词</title>
				<description>&lt;h1 id=&quot;es-中文分词&quot;&gt;ES 中文分词&lt;/h1&gt;

&lt;p&gt;这里使用 ES 8.2.0  所以建表不需要_doc关键字了。&lt;/p&gt;

&lt;h3 id=&quot;建表&quot;&gt;建表&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT /table_1 
{
  &quot;mappings&quot;: {
     &quot;properties&quot;: { 
      &quot;title&quot;:    { &quot;type&quot;: &quot;text&quot;  }, 
      &quot;name&quot;:     { &quot;type&quot;: &quot;keyword&quot;  }, 
      &quot;description&quot;: {&quot;type&quot;: &quot;text&quot;},
      &quot;age&quot;:      { &quot;type&quot;: &quot;integer&quot; },  
      &quot;created&quot;:  {
        &quot;type&quot;:   &quot;date&quot;, 
        &quot;format&quot;: &quot;strict_date_optional_time||epoch_millis&quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;写入数据&quot;&gt;写入数据&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST table_1/_doc/1
{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;文档名称&quot;,
  &quot;title&quot;: &quot;中文标题&quot;,
  &quot;description&quot;:&quot;文档描述&quot;,
  &quot;type&quot;:&quot;科普&quot;,
  &quot;score&quot;: 96
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;搜索&quot;&gt;搜索&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST table_1/_search
{
  &quot;query&quot;: {
    &quot;match_all&quot;: {}
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;should--or-子句&quot;&gt;should  (or) 子句&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST table_1/_search
{
  &quot;query&quot;: {
    &quot;bool&quot; : {
      &quot;should&quot;: [
        {&quot;term&quot;: {
&quot;title&quot;: &quot;中&quot;
}},
{
&quot;term&quot;: {
&quot;title&quot;: &quot;文&quot;
}
}
      ]
    }
    
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;中文搜索&quot;&gt;中文搜索&lt;/h3&gt;

&lt;p&gt;keyword 是全匹配，text有analyzer可以创建分词策略 . 多个field 对应 多个analyzer &lt;a href=&quot;https://blog.csdn.net/JineD/article/details/108845906&quot;&gt;https://blog.csdn.net/JineD/article/details/108845906&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;keyword 得全匹配才行， text默认的分词策略， 默认分词  “中文” =&amp;gt; “中” “文”  ，所以输入  “中文”无法命中，&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG186.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;
&lt;img src=&quot;/images/202205/WechatIMG187.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;下拉搜索的场景-可以使用whitespace-analyzer&quot;&gt;下拉搜索的场景, 可以使用whitespace analyzer&lt;/h4&gt;
&lt;p&gt;保存的时候 写入 “中 中文 中文标 中文标题 文 文标 文标题 标题 题”&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT table_3
{
  &quot;mappings&quot;: {
      &quot;properties&quot;: {
        &quot;title&quot;: {
          &quot;type&quot;: &quot;text&quot;,
          &quot;analyzer&quot;: &quot;whitespace&quot;,
          &quot;fields&quot;: {
           
            &quot;standard&quot;: {
              &quot;type&quot;: &quot;text&quot;,
              &quot;analyzer&quot;: &quot;standard&quot;
            }
          }
        }
      }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG185.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;中文分词场景&quot;&gt;中文分词场景&lt;/h4&gt;

&lt;p&gt;IK分词 参考文章：&lt;a href=&quot;https://blog.csdn.net/weixin_40612128/article/details/123476150&quot;&gt;https://blog.csdn.net/weixin_40612128/article/details/123476150&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;记得把版本号改对&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elasticsearch-plugin -v install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.2.0/elasticsearch-analysis-ik-8.2.0.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PUT table_ik
{
  &quot;mappings&quot;: {
      &quot;properties&quot;: {
        &quot;title&quot;: {
          &quot;type&quot;: &quot;text&quot;,
          &quot;analyzer&quot;: &quot;whitespace&quot;,
          &quot;fields&quot;: {
            &quot;spy&quot;: {
              &quot;type&quot;: &quot;text&quot;,
              &quot;analyzer&quot;: &quot;ik_smart&quot;
            },
            &quot;standard&quot;: {
              &quot;type&quot;: &quot;text&quot;,
              &quot;analyzer&quot;: &quot;standard&quot;
            },
            &quot;fpy&quot;: {
              &quot;type&quot;: &quot;text&quot;,
              &quot;analyzer&quot;: &quot;ik_smart&quot;
            }
          }
        }
      }
    
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG188.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;after-search&quot;&gt;After Search&lt;/h3&gt;

&lt;p&gt;本质上是个where语句。 scroll查询 那样保存上下文，开销比较大。 注意这个search_after是开区间，不包括当前值97 ，所以尽量用一些唯一的值比如 id来search.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG189.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;
</description>
				<pubDate>Fri, 20 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/ES-IK</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/ES-IK</guid>
			</item>
		
			<item>
				<title>cas</title>
				<description>&lt;h1 id=&quot;cas&quot;&gt;CAS&lt;/h1&gt;

&lt;p&gt;参考文章： &lt;a href=&quot;https://coderatwork.cn/posts/linux-cmpxchg/&quot;&gt;https://coderatwork.cn/posts/linux-cmpxchg/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unsafe.compareAndSetObject&lt;/p&gt;

&lt;p&gt;内部调用native cmpxchg汇编指令&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;在多核环境中，一般还在指令前加上 LOCK 前缀，来保证指令执行的原子性（LOCK 前缀的主要功能应该是锁内存总线）。&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Thu, 19 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/CAS</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/CAS</guid>
			</item>
		
			<item>
				<title>disruptor</title>
				<description>&lt;h1 id=&quot;disruptor&quot;&gt;Disruptor&lt;/h1&gt;

&lt;p&gt;Disruptor是英国外汇交易公司LMAX开发的一个高性能队列. 多消费者之间还能形成依赖(then关键字)&lt;/p&gt;

&lt;p&gt;代码仓库: &lt;a href=&quot;https://github.com/gongchangyou/disruptor&quot;&gt;https://github.com/gongchangyou/disruptor&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Pom.xml&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;      &amp;lt;!-- https://mvnrepository.com/artifact/com.lmax/disruptor --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.lmax&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;disruptor&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;3.4.4&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;单生产者，单消费者&lt;/p&gt;
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/**
     * 单生产者 单消费者
     */
    @Test
    void contextLoads() {
        // 队列中的元素
        class Element {
   
            private int value;
   
            public int get(){
                return value;
            }
   
            public void set(int value){
                this.value= value;
            }
   
        }
   
        // 生产者的线程工厂
        ThreadFactory threadFactory = new ThreadFactory(){
            int i = 0;
            @Override
            public Thread newThread(Runnable r) {
                return new Thread(r, &quot;simpleThread &quot; + i++);
            }
        };
   
        // RingBuffer生产工厂,初始化RingBuffer的时候使用
        EventFactory&amp;lt;Element&amp;gt; factory = new EventFactory&amp;lt;Element&amp;gt;() {
            @Override
            public Element newInstance() {
                return new Element();
            }
        };
   
        // 处理Event的handler
        EventHandler&amp;lt;Element&amp;gt; handler = new EventHandler&amp;lt;Element&amp;gt;(){
            @Override
            public void onEvent(Element element, long sequence, boolean endOfBatch)
            {
                log.info(&quot;element={}, sequence={}, endOfBatch={}&quot;, element.get(), sequence, endOfBatch);
//                System.out.println(&quot;Element: &quot; + element.get());
            }
        };
   
        // 阻塞策略
        BlockingWaitStrategy strategy = new BlockingWaitStrategy();
   
        // 指定RingBuffer的大小
        int bufferSize = 16;
   
        // 创建disruptor，采用单生产者模式
        Disruptor&amp;lt;Element&amp;gt; disruptor = new Disruptor(factory, bufferSize, threadFactory, ProducerType.SINGLE, strategy);
   
        // 设置EventHandler
        disruptor.handleEventsWith(handler);
   
        // 启动disruptor的线程
        disruptor.start();
   
        RingBuffer&amp;lt;Element&amp;gt; ringBuffer = disruptor.getRingBuffer();
   
        for (int l = 0; true; l++) {
            // 获取下一个可用位置的下标
            long sequence = ringBuffer.next();
            try {
                // 返回可用位置的元素
                Element event = ringBuffer.get(sequence);
                // 设置该位置元素的值
                event.set(l);
            } finally {
                ringBuffer.publish(sequence);
            }
            try {
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;问题1： 有不同的消费者依赖怎么办？
回答1：  关键字 then&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	//多个消费者间形成依赖关系，每个依赖节点的消费者为单线程。
        disruptor.handleEventsWith(new OrderHandler1(&quot;1&quot;)).then(new OrderHandler1(&quot;2&quot;), new OrderHandler1(&quot;3&quot;)).then(new OrderHandler1(&quot;4&quot;));
       
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;问题2： 希望不同的消费者不重复的消费怎么办？即多个consumer 加速消费
回答2:  handleEventsWithWorkerPool&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;disruptor.handleEventsWithWorkerPool(new OrderHandler1(&quot;1&quot;), new OrderHandler1(&quot;2&quot;));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;问题3： 希望不同的消费者独立消费
回答3： handleEventsWith 多个handler即可&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; disruptor.handleEventsWith(new OrderHandler1(&quot;1&quot;), new OrderHandler1(&quot;2&quot;));
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;官方文档: &lt;a href=&quot;https://lmax-exchange.github.io/disruptor/disruptor.html&quot;&gt;https://lmax-exchange.github.io/disruptor/disruptor.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;参考文章: &lt;a href=&quot;https://tech.meituan.com/2016/11/18/disruptor.html&quot;&gt;https://tech.meituan.com/2016/11/18/disruptor.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/pku-liuqiang/p/8544700.html&quot;&gt;https://www.cnblogs.com/pku-liuqiang/p/8544700.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/pku-liuqiang/p/8532737.html&quot;&gt;https://www.cnblogs.com/pku-liuqiang/p/8532737.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cloud.tencent.com/developer/article/1701690&quot;&gt;https://cloud.tencent.com/developer/article/1701690&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;源码解析： TODO&lt;/p&gt;

</description>
				<pubDate>Wed, 18 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/Disruptor</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/Disruptor</guid>
			</item>
		
			<item>
				<title>swagger</title>
				<description>&lt;h1 id=&quot;swagger&quot;&gt;swagger&lt;/h1&gt;

&lt;p&gt;官网： &lt;a href=&quot;https://swagger.io/&quot;&gt;https://swagger.io/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;参考文章:  &lt;a href=&quot;https://www.jianshu.com/p/088163459147&quot;&gt;https://www.jianshu.com/p/088163459147&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;​			&lt;a href=&quot;http://c.biancheng.net/view/5532.html&quot;&gt;http://c.biancheng.net/view/5532.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;项目地址:  &lt;a href=&quot;https://github.com/gongchangyou/swagger&quot;&gt;https://github.com/gongchangyou/swagger&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;添加依赖&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;      &amp;lt;!-- https://mvnrepository.com/artifact/com.spring4all/swagger-spring-boot-starter --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.spring4all&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;swagger-spring-boot-starter&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;2.0.2.RELEASE&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;配置swagger&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;@Configuration
@Profile({&quot;dev&quot;,&quot;local&quot;})
@EnableSwagger2
@EnableWebMvc
public class SwaggerConfig {
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;访问地址 :  http://localhost:8082/swagger-ui/index.html  这个8082就是 Tomcat 的 port&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;添加注解
&lt;img src=&quot;/images/202205/WechatIMG148.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;再次访问，这次说明文档都展示出来了。
&lt;img src=&quot;/images/202205/WechatIMG147.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;问题1 ： Failed to start bean ‘documentationPluginsBootstrapper‘的编译错误&lt;/p&gt;

&lt;p&gt;回答1: &lt;a href=&quot;https://www.cnblogs.com/rainbow70626/p/15680184.html&quot;&gt;https://www.cnblogs.com/rainbow70626/p/15680184.html&lt;/a&gt; 添加注解 @EnableWebMvc&lt;/p&gt;

&lt;p&gt;问题2： 如何添加response 的schema ?&lt;/p&gt;

&lt;p&gt;回答2： 
直接如下这样写是没用的。
&lt;img src=&quot;/images/202205/WechatIMG151.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;br /&gt;
需要使用v3的ApiResponse
&lt;img src=&quot;/images/202205/WechatIMG159.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;br /&gt;
这样ok了
&lt;img src=&quot;/images/202205/WechatIMG153.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;问题3： 如何添加response为list的schema ?&lt;/p&gt;

&lt;p&gt;回答3：如下乱写当然也行，swagger并不会去比对schema的implementation和 method的returnType. 这样当然swagger ui html也会显示成OutputModel，而不是一个list.所以这种写法全靠自觉。
&lt;img src=&quot;/images/202205/WechatIMG154.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;正确的写法应该如下所示，引入ArraySchema,且把原先的ApiResponse给删掉，否则会冲突，导致无法正常显示。
&lt;img src=&quot;/images/202205/WechatIMG156.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;br /&gt;
&lt;img src=&quot;/images/202205/WechatIMG158.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;br /&gt;
这下显示ok了
&lt;img src=&quot;/images/202205/WechatIMG157.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

</description>
				<pubDate>Tue, 17 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/swagger</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/swagger</guid>
			</item>
		
			<item>
				<title>java项目 依赖检查</title>
				<description>&lt;h1 id=&quot;owasp&quot;&gt;OWASP&lt;/h1&gt;

&lt;p&gt;官网： &lt;a href=&quot;https://owasp.org/&quot;&gt;https://owasp.org/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;网站安全top 10: &lt;a href=&quot;https://owasp.org/www-project-top-ten/&quot;&gt;https://owasp.org/www-project-top-ten/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;检测插件 &lt;a href=&quot;https://blog.csdn.net/qq_35624642/article/details/122438449&quot;&gt;https://blog.csdn.net/qq_35624642/article/details/122438449&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--        代码依赖包安全漏洞检测--&amp;gt;
&amp;lt;!-- https://mvnrepository.com/artifact/org.owasp/dependency-check-maven --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.owasp&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;dependency-check-maven&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;6.5.2&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &amp;lt;!--        代码依赖包安全漏洞检测--&amp;gt;
            &amp;lt;plugin&amp;gt;
                &amp;lt;groupId&amp;gt;org.owasp&amp;lt;/groupId&amp;gt;
                &amp;lt;artifactId&amp;gt;dependency-check-maven&amp;lt;/artifactId&amp;gt;
                &amp;lt;configuration&amp;gt;
                    &amp;lt;autoUpdate&amp;gt;true&amp;lt;/autoUpdate&amp;gt;
                &amp;lt;/configuration&amp;gt;
                &amp;lt;executions&amp;gt;
                    &amp;lt;execution&amp;gt;
                        &amp;lt;goals&amp;gt;
                            &amp;lt;goal&amp;gt;check&amp;lt;/goal&amp;gt;
                        &amp;lt;/goals&amp;gt;
                    &amp;lt;/execution&amp;gt;
                &amp;lt;/executions&amp;gt;
            &amp;lt;/plugin&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如下图点击maven:check&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG143.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;p&gt;运行结束后，会在target下生成检测报告dependency-check-report.html，直接浏览器打开查看就可以了&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/202205/WechatIMG144.png&quot; alt=&quot;&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

</description>
				<pubDate>Sun, 15 May 2022 10:25:06 +0800</pubDate>
				<link>http://localhost:4000/2022/05/OWASP</link>
				<guid isPermaLink="true">http://localhost:4000/2022/05/OWASP</guid>
			</item>
		
	</channel>
</rss>
