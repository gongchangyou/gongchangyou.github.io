---
layout: post
title: "rocket mq"
date: 2022-01-21 14:25:06 +0800
comments: true
category: java
tag: [java]
---



#  RocketMQ 部署


参考 [https://www.cnblogs.com/fx-blog/p/11732749.html](https://www.cnblogs.com/fx-blog/p/11732749.html)


1. 下载RocketMQ zip包 [https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.9.2/rocketmq-all-4.9.2-bin-release.zip](https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.9.2/rocketmq-all-4.9.2-bin-release.zip)

2. 先启动 name service
  ```
  nohup sh bin/mqnamesrv &
  ```

3. 再启动 broker service. 注意 vi bin/runbroker.sh 里面的 -Xms 内存要求是8g
  ```
  nohup sh bin/mqbroker -n localhost:9876 &
  ```

  

4. 测试下 是否可以正常生产、消费

   ```
   export NAMESRV_ADDR=localhost:9876
   sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer
   
   sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer	
   ```

5. 关闭服务器
```
停止 broker：sh bin/mqshutdown broker
停止 nameserver：sh bin/mqshutdown namesrv
```

## 控制台启动

1. 下载 控制台安装包 注意现在拆分出来了 [https://github.com/apache/rocketmq-dashboard](https://github.com/apache/rocketmq-dashboard)
```
git clone git@github.com:apache/rocketmq-dashboard.git
```

2. 看  readme 直接 docker 搞起

    ```
    docker pull apacherocketmq/rocketmq-dashboard:latest

    ## 注意这里看看本地端口哪个可用，我这里用了8081
    docker run -d --name rocketmq-dashboard -e "JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.145:9876" -p 8081:8080 -t apacherocketmq/rocketmq-dashboard:latest
    ```

    如果是docker启动的话，上面Drocketmq.namesrv.addr参数直接用127.0.0.1:9876 会让dashboard无法连接到本地的9876端口，只能说docker容器中的 127.0.0.1 9876 不是宿主机的那个

    如果是自行打包并且启动jar包的话，应该是用127.0.0.1 没问题的


3. 浏览器打开 localhost:8081



![embbed]({{ site.baseurl}}/images/202201/1642757861082.jpg)